# 大数据之Hive

[TOC]

### 1. 数仓的特征

1. 面向主题：数据残酷通过一个个主题或多个业务系统的数据加载到一块，为各个主题分析而建
2. 集成性：数仓会将不同数据源的数据汇总到一起进行分析，必须统一数据源然后分析
3. 非易失性：数仓主要用于分析数据，所以保留了相当长时间的数据，一般只执行查询操作和定期加载和刷新，很少删除和更新
4. 时变性：数仓包含各种粒度的历史数据，数据需要定时更新，以适应决策的需要

### 2. 数据仓库和数据库的区别

首先要明白，数据仓库的出现，并不是要取代

- 数据库是面向事务的设计，数据仓库是面向主题设计的。
- 数据库一般存储业务数据，数据仓库存储的一般是历史数据。 
- 数据库设计是尽量避免冗余，一般针对某一业务应用进行设计，比如一张简单的User表， 记录用户名、密码等简单数据即可，符合业务应用，但是不符合分析。数据仓库在设计 是有意引入冗余，依照分析需求，分析维度、分析指标进行设计。
-  数据库是为捕获数据而设计，数据仓库是为分析数据而设计。

**数据仓库，是在数据库已经大量存在的情况下，为了进一步挖掘数据资源、为了决策需要而 产生的，它决不是所谓的“大型数据库”。**

### 3. 数仓的分层架构

- 源数据层（ODS） ：此层数据无任何更改，直接沿用外围系统数据结构和数据，不对外开 放；为临时存储层，是接口数据的临时存储区域，为后一步的数据处理做准备。 
- 数据仓库层（DW） ：也称为细节层，DW层的数据应该是一致的、准确的、干净的数据， 即对源系统数据进行了清洗（去除了杂质）后的数据。 
- 数据应用层（DA或APP） ：前端应用直接读取的数据源；根据报表、专题分析需求而计算 生成的数据。

**为什么要对数据仓库分层？**

用空间换取时间，通过大量的预处理来提升应用系统的用户体验，一次数据仓库会存在大量冗余的数据

### 4. 数仓的元数据管理

**元数据**：主要记录数据仓库中模型的定义、个层级间的映射关系、监控数据仓库的数据状态及ETL的任务运行状态。一般会通过元数据资料库来统一地存储和挂管理元数据，其主要目的时使数据仓库的设计、部署、操作和管理能达成协同和一致。

### 5. Hive 简介

- ##### hive是什么

  - ##### hive 是大数据生态圈中基于Hadoop的一个数据仓库工具，可以将**结构化数据**文件映射为一张数据库表，并提供类sql查询功能

  - ##### 其本质是将sql转换为MapReduce的任务进行计算，最终存储在HDFS 上，可以将hive理解为是一个将sql转换为mapreduce的任务的工具，甚至可以说hive是一个mapreduce的客户端


- ##### 为什么使用Hive

  - ##### 采用类sql语法去操作数据，提供快速开发的能力

  - ##### 避免了去写MapReduce，减少开发人员的学习成本

  - ##### 功能扩展很方便


- Hive 与 Hadoop的关系
  - Hive 利用HDFS 存储数据，利用MapReduce查询分析数据

### 6. Hive 与传统数据库对比

|              |         Hive          |         RDBMS          |
| :----------- | :-------------------: | :--------------------: |
| 查询语言     |          HQL          |          SQL           |
| 数据存储     |         HDFS          | Raw Device or Local FS |
| 执行         |       MapReduce       |        Excutor         |
| 执行延迟     |          高           |           低           |
| 处理数据规模 |          大           |           小           |
| 索引         | 0.8版本后加入位图索引 |      有复杂的索引      |

> 总结：hive 具有sql数据库的外表，但应用场景完全不同，hive只适合用来做批量数据统计分析